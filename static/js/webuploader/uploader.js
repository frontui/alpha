/*! generator-frontman v0.1.2
*  by frontui
*  (c) 2014-2017 www.frontpay.cn
* updated on 2017-01-03
*  Licensed under MIT
*/
 function removeUploadFile(e){e.preventDefault();var $parent=$(this).parent(),fileName=$parent.attr("data-file"),$input=$parent.siblings(".uploadName"),fileNames=$input.val(),files=fileNames.split(","),index=$.inArray(fileName,files);files.length>1?(files=files.splice(index,1),$input.val(files.join(","))):$input.val(""),$parent.remove()}function addImage(targetObj,originalSrc,thumbSrc){var newLi=$('<li><input type="hidden" name="hid_photo_name" value="0|'+originalSrc+"|"+thumbSrc+'" /><input type="hidden" name="hid_photo_remark" value="" /><div class="img-box" onclick="setFocusImg(this);"><img src="'+thumbSrc+'" bigsrc="'+originalSrc+'" /><span class="remark"><i>暂无描述...</i></span></div><a href="javascript:;" onclick="setRemark(this);">描述</a><a href="javascript:;" onclick="delImg(this);">删除</a></li>');newLi.appendTo(targetObj.siblings(".photo-list").children("ul"));var focusPhotoObj=targetObj.siblings(".focus-photo");""==focusPhotoObj.val()&&(focusPhotoObj.val(thumbSrc),newLi.children(".img-box").addClass("selected"))}function setFocusImg(obj){var focusPhotoObj=$(obj).parents(".photo-list").siblings(".focus-photo");focusPhotoObj.val($(obj).children("img").eq(0).attr("src")),$(obj).parent().siblings().children(".img-box").removeClass("selected"),$(obj).addClass("selected")}function setRemark(obj){var parentObj=$(obj),hidRemarkObj=parentObj.prevAll("input[name='hid_photo_remark']").eq(0);parent.dialog({title:"图片描述",content:'<textarea id="ImageRemark" style="margin:10px 0;font-size:12px;padding:3px;color:#000;border:1px #d2d2d2 solid;vertical-align:middle;width:300px;height:50px;">'+hidRemarkObj.val()+"</textarea>",button:[{value:"批量描述",callback:function(){var remarkObj=$("#ImageRemark",parent.document);return""==remarkObj.val()?(parent.dialog({title:"提示",content:"亲，总该写点什么吧？",okValue:"确定",ok:function(){},onclose:function(){remarkObj.focus()}}).showModal(),!1):(parentObj.parent().parent().find("li input[name='hid_photo_remark']").val(remarkObj.val()),void parentObj.parent().parent().find("li .img-box .remark i").html(remarkObj.val()))}},{value:"单张描述",callback:function(){var remarkObj=$("#ImageRemark",parent.document);return""==remarkObj.val()?(parent.dialog({title:"提示",content:"亲，总该写点什么吧？",okValue:"确定",ok:function(){},onclose:function(){remarkObj.focus()}}).showModal(),!1):(hidRemarkObj.val(remarkObj.val()),void parentObj.siblings(".img-box").children(".remark").children("i").html(remarkObj.val()))},autofocus:!0}]}).showModal()}function delImg(obj){var parentObj=$(obj).parent().parent(),focusPhotoObj=parentObj.parent().siblings(".focus-photo"),smallImg=$(obj).siblings(".img-box").children("img").attr("src");if($(obj).parent().remove(),focusPhotoObj.val()==smallImg){focusPhotoObj.val("");var firtImgBox=parentObj.find("li .img-box").eq(0);firtImgBox.addClass("selected"),focusPhotoObj.val(firtImgBox.children("img").attr("src"))}}$(function(){$.upLoadDefaults=$.upLoadDefaults||{},$.upLoadDefaults.property={multiple:!1,water:!1,thumbnail:!1,sendurl:null,filetypes:"jpg,jpeg,bmp,png,gif,pdf,doc,docx",filesize:"204800",btntext:"点击上传",swf:null,compress:{quality:90}},$.fn.InitUploader=function(p){var fun=function(parentObj){p=$.extend({},$.upLoadDefaults.property,p||{});var btnObj=$('<div class="upload-btn">'+p.btntext+"</div>").appendTo(parentObj);p.sendurl+="?action=UpLoadFile",p.water&&(p.sendurl+="&IsWater=1"),p.thumbnail&&(p.sendurl+="&IsThumbnail=1"),p.multiple||(p.sendurl+="&DelFilePath="+parentObj.siblings(".upload-path").val());var uploader=WebUploader.create({auto:!0,swf:p.swf,server:p.sendurl,pick:{id:btnObj,multiple:p.multiple},accept:{extensions:p.filetypes},formData:{DelFilePath:""},fileSingleSizeLimit:1024*p.filesize});uploader.on("error",function(type){switch(type){case"Q_EXCEED_NUM_LIMIT":alert("错误：上传文件数量过多！");break;case"Q_EXCEED_SIZE_LIMIT":alert("错误：文件总大小超出限制！");break;case"F_EXCEED_SIZE":alert("错误：文件大小超出限制！");break;case"Q_TYPE_DENIED":alert("您上传的文件类型不符合要求！");break;case"F_DUPLICATE":alert("错误：请勿重复上传该文件！");break;default:alert("错误代码："+type)}}),uploader.on("fileQueued",function(file){if(p.multiple||(uploader.options.formData.DelFilePath=parentObj.siblings(".upload-path").val()),0==parentObj.children(".upload-progress").length){var fileProgressObj=$('<div class="upload-progress"></div>').appendTo(parentObj),progressCancel=($('<span class="txt">正在上传，请稍候...</span>').appendTo(fileProgressObj),$('<span class="bar"><b></b></span>').appendTo(fileProgressObj),$('<a class="close" title="取消上传">关闭</a>').appendTo(fileProgressObj));progressCancel.click(function(){uploader.cancelFile(file),fileProgressObj.remove()})}}),uploader.on("uploadProgress",function(file,percentage){var progressObj=parentObj.children(".upload-progress");progressObj.children(".txt").html(file.name),progressObj.find(".bar b").width(100*percentage+"%")}),uploader.on("uploadError",function(file,reason){uploader.removeFile(file),alert(file.name+"上传失败，错误代码："+reason)}),uploader.on("uploadSuccess",function(file,data){if("0"==data.status){var progressObj=parentObj.children(".upload-progress");progressObj.children(".txt").html(data.msg),alert(data.msg)}if("1"==data.status){if(p.multiple){var fileNames=parentObj.siblings(".uploadName").val(),names=data.name.split("."),name=names[0].length>13?names[0].substring(0,13)+"...":names[0],fileName=$.trim(fileNames)?fileNames+","+data.path:data.path;parentObj.siblings(".uploadName").val(fileName);var $item=$('<p data-file="'+fileName+'"><span class="uploadName">'+name+"."+names[1]+'</span><a href="javascript:void(0);" class="error-FontColor1 fn-ml-10" title="删除文件" style="display:inline-block;vertical-align: middle;"><i class="icon-clear"></i></a></p>');parentObj.before($item),$item.find("a").one("click",removeUploadFile)}else{var names=data.name.split("."),name=names[0].length>13?names[0].substring(0,13)+"...":names[0];parentObj.siblings(".uploadName").val(data.name),parentObj.siblings(".upload-name").text(name+"."+names[1]),parentObj.siblings(".upload-path").val(data.path),parentObj.siblings(".upload-size").val(data.size);var $parents=parentObj.parents(".form-group");$parents.find(".upload-img-yours").attr("src",file.name),"0"==data.info&&$parents.find(".upload-img-alert").show()}var progressObj=parentObj.children(".upload-progress");progressObj.children(".txt").html("上传成功："+file.name)}uploader.removeFile(file)}),uploader.on("uploadComplete",function(file){var progressObj=parentObj.children(".upload-progress");progressObj.children(".txt").html("上传完成"),0==uploader.getStats().queueNum&&progressObj.remove()})};return $(this).each(function(){fun($(this))})}});